<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Monitoring Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/d3-flame-graph@4.1.3/dist/d3-flamegraph.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            width: 90%;
            max-width: 1200px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .chart {
            height: 200px;
        }

        .logs {
            height: 400px;
            overflow-y: scroll;
            background: #333;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
        }

        .flamechart {
            height: 400px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        .cpu-usage {
            height: 400px;
        }

        .cpu-usage canvas {
            height: 100% !important;
        }

        .apm {
            height: 200px;
        }

        .apm canvas {
            height: 100% !important;
        }

        .sql-queries {
            height: 300px;
            overflow-y: scroll;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f4f4f4;
        }

        .fast {
            color: green;
        }

        .slow {
            color: red;
        }
    </style>
</head>

<body>
    <h1>Server Monitoring Dashboard</h1>
    <div class="dashboard">
        <div class="card">
            <h2>CPU Usage</h2>
            <canvas id="cpuChart" class="chart"></canvas>
        </div>
        <div class="card">
            <h2>Memory Usage</h2>
            <canvas id="memoryChart" class="chart"></canvas>
        </div>
        <div class="card">
            <h2>Network Bandwidth</h2>
            <canvas id="networkChart" class="chart"></canvas>
        </div>
        <div class="card">
            <h2>CPU Utilization per Core</h2>
            <canvas id="cpuUtilizationChart" class="cpu-usage"></canvas>
        </div>
        <div class="card">
            <h2>Requests per Second</h2>
            <canvas id="requestsPerSecondChart" class="apm"></canvas>
        </div>
        <div class="card">
            <h2>HTTP Server Error Rate</h2>
            <canvas id="errorRateChart" class="apm"></canvas>
        </div>
        <div class="card">
            <h2>Database Queries</h2>
            <canvas id="dbQueriesChart" class="apm"></canvas>
        </div>
        <div class="card">
            <h2>GC Metrics</h2>
            <canvas id="gcMetricsChart" class="apm"></canvas>
        </div>
        <div class="card">
            <h2>SQL Query Performance</h2>
            <div class="sql-queries">
                <table id="sqlQueryTable">
                    <thead>
                        <tr>
                            <th>Query</th>
                            <th>Execution Time (ms)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card">
            <h2>Logs</h2>
            <div id="logs" class="logs"></div>
        </div>
        <div class="card">
            <h2>Flamechart</h2>
            <div id="flamechart" class="flamechart"></div>
        </div>

        <div class="card">
            <h2>Peak Response Time</h2>
            <canvas id="peakResponseTimeChart" class="apm"></canvas>
            <div id="percentilesTable">
                <h3>Response Time Percentiles</h3>
                <table class="percentiles-table" id="percentilesTableContent">
                    <thead>
                        <tr>
                            <th>Percentile</th>
                            <th>Response Time (ms)</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://d3js.org/d3.v7.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flame-graph@4.1.3/dist/d3-flamegraph.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const cpuChartCtx = document.getElementById('cpuChart').getContext('2d');
        const memoryChartCtx = document.getElementById('memoryChart').getContext('2d');
        const networkChartCtx = document.getElementById('networkChart').getContext('2d');
        const cpuUtilizationCtx = document.getElementById('cpuUtilizationChart').getContext('2d');
        const requestsPerSecondCtx = document.getElementById('requestsPerSecondChart').getContext('2d');
        const peakResponseTimeCtx = document.getElementById('peakResponseTimeChart').getContext('2d');
        const errorRateCtx = document.getElementById('errorRateChart').getContext('2d');
        const dbQueriesCtx = document.getElementById('dbQueriesChart').getContext('2d');
        const gcMetricsCtx = document.getElementById('gcMetricsChart').getContext('2d');


        const cpuChart = new Chart(cpuChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'CPU Usage (%)',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const memoryChart = new Chart(memoryChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Memory Usage (MB)',
                    data: [],
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const networkChart = new Chart(networkChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Network Bandwidth (Mbps)',
                    data: [],
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const cpuUtilizationChart = new Chart(cpuUtilizationCtx, {
            type: 'bar',
            data: {
                labels: Array.from({ length: 16 }, (_, i) => `Core ${i + 1}`),
                datasets: [{
                    label: 'CPU Utilization (%)',
                    data: Array(16).fill(0),
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    x: { stacked: true },
                    y: { beginAtZero: true }
                }
            }
        });

        const requestsPerSecondChart = new Chart(requestsPerSecondCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Requests per Second',
                    data: [],
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const peakResponseTimeChart = new Chart(peakResponseTimeCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Max Response Time (ms)',
                        data: [],
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        fill: false
                    },
                    {
                        label: '50th Percentile Response Time (ms)',
                        data: [],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    },
                    {
                        label: '95th Percentile Response Time (ms)',
                        data: [],
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    },
                    {
                        label: '99th Percentile Response Time (ms)',
                        data: [],
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    }
                ]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const errorRateChart = new Chart(errorRateCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'HTTP Error Rate (%)',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const dbQueriesChart = new Chart(dbQueriesCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Database Queries per Second',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        const gcMetricsChart = new Chart(gcMetricsCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'GC Time (ms)',
                    data: [],
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        function updateCharts() {
            const now = new Date().toLocaleTimeString();
            const cpuUsage = Math.random() * 100;
            const memoryUsage = Math.random() * 16000;
            const networkBandwidth = Math.random() * 1000;

            if (cpuChart.data.labels.length > 20) {
                cpuChart.data.labels.shift();
                cpuChart.data.datasets[0].data.shift();
            }
            cpuChart.data.labels.push(now);
            cpuChart.data.datasets[0].data.push(cpuUsage);
            cpuChart.update();

            if (memoryChart.data.labels.length > 20) {
                memoryChart.data.labels.shift();
                memoryChart.data.datasets[0].data.shift();
            }
            memoryChart.data.labels.push(now);
            memoryChart.data.datasets[0].data.push(memoryUsage);
            memoryChart.update();

            if (networkChart.data.labels.length > 20) {
                networkChart.data.labels.shift();
                networkChart.data.datasets[0].data.shift();
            }
            networkChart.data.labels.push(now);
            networkChart.data.datasets[0].data.push(networkBandwidth);
            networkChart.update();
        }

        function updateLogs() {
            const logs = document.getElementById('logs');
            const newLog = `Log entry at ${new Date().toLocaleTimeString()}`;
            logs.innerHTML = `<p>${newLog}</p>` + logs.innerHTML;
            if (logs.childElementCount > 50) {
                logs.removeChild(logs.lastChild);
            }
        }

        function createFlamechart() {
            const flamegraphChart = flamegraph()
                .width(960)
                .height(400)
                .transitionDuration(750)
                .minFrameSize(5)
                .title("");

            d3.select("#flamechart")
                .datum(getFlamechartData())
                .call(flamegraphChart);
        }

        function getFlamechartData() {
            return {
                name: "root",
                value: 100,
                children: [
                    {
                        name: "functionA",
                        value: 50,
                        children: [
                            { name: "functionB", value: 20 },
                            { name: "functionC", value: 30 }
                        ]
                    },
                    {
                        name: "functionD",
                        value: 50,
                        children: [
                            { name: "functionE", value: 20 },
                            { name: "functionF", value: 30 }
                        ]
                    },
                    {
                        name: "functionG",
                        value: 50,
                        children: [
                            { name: "functionH", value: 20 },
                            { name: "functionI", value: 30 }
                        ]
                    },
                    {
                        name: "functionJ",
                        value: 50,
                        children: [
                            { name: "functionK", value: 20 },
                            { name: "functionL", value: 30 }
                        ]
                    }
                ]
            };
        }

        function updateCpuUtilization() {
            const cpuUtilizationData = Array.from({ length: 16 }, () => Math.random() * 100);
            cpuUtilizationChart.data.datasets[0].data = cpuUtilizationData;
            cpuUtilizationChart.update();
        }

        function updateApmMetrics() {
            const now = new Date().toLocaleTimeString();
            const requestsPerSecond = Math.random() * 100;
            const peakResponseTime = Math.random() * 500;
            const p50ResponseTime = Math.random() * 400;
            const p95ResponseTime = Math.random() * 450;
            const p99ResponseTime = Math.random() * 490;
            const errorRate = Math.random() * 10;
            const dbQueries = Math.random() * 50;
            const gcMetrics = Math.random() * 100;

            if (requestsPerSecondChart.data.labels.length > 20) {
                requestsPerSecondChart.data.labels.shift();
                requestsPerSecondChart.data.datasets[0].data.shift();
            }
            requestsPerSecondChart.data.labels.push(now);
            requestsPerSecondChart.data.datasets[0].data.push(requestsPerSecond);
            requestsPerSecondChart.update();

            if (peakResponseTimeChart.data.labels.length > 20) {
                peakResponseTimeChart.data.labels.shift();
                peakResponseTimeChart.data.datasets.forEach(dataset => dataset.data.shift());
            }
            peakResponseTimeChart.data.labels.push(now);
            peakResponseTimeChart.data.datasets[0].data.push(Math.random() * 500); // Max Response Time
            peakResponseTimeChart.data.datasets[1].data.push(p50ResponseTime); // 50th Percentile
            peakResponseTimeChart.data.datasets[2].data.push(p95ResponseTime); // 95th Percentile
            peakResponseTimeChart.data.datasets[3].data.push(p99ResponseTime); // 99th Percentile
            peakResponseTimeChart.update();

            if (errorRateChart.data.labels.length > 20) {
                errorRateChart.data.labels.shift();
                errorRateChart.data.datasets[0].data.shift();
            }
            errorRateChart.data.labels.push(now);
            errorRateChart.data.datasets[0].data.push(errorRate);
            errorRateChart.update();

            if (dbQueriesChart.data.labels.length > 20) {
                dbQueriesChart.data.labels.shift();
                dbQueriesChart.data.datasets[0].data.shift();
            }
            dbQueriesChart.data.labels.push(now);
            dbQueriesChart.data.datasets[0].data.push(dbQueries);
            dbQueriesChart.update();

            if (gcMetricsChart.data.labels.length > 20) {
                gcMetricsChart.data.labels.shift();
                gcMetricsChart.data.datasets[0].data.shift();
            }
            gcMetricsChart.data.labels.push(now);
            gcMetricsChart.data.datasets[0].data.push(gcMetrics);
            gcMetricsChart.update();
        }

        function updateSqlQueryTable() {
            const tableBody = document.getElementById('sqlQueryTable').getElementsByTagName('tbody')[0];
            const query = `SELECT * FROM table WHERE id = ${Math.floor(Math.random() * 100)}`;
            const executionTime = Math.random() * 1000;
            const status = executionTime > 500 ? 'Slow' : 'Fast';
            const statusClass = status.toLowerCase();

            const newRow = tableBody.insertRow(0);
            newRow.innerHTML = `
                <td>${query}</td>
                <td>${executionTime.toFixed(2)}</td>
                <td class="${statusClass}">${status}</td>
            `;

            if (tableBody.rows.length > 20) {
                tableBody.deleteRow(-1);
            }
        }

        function updatePercentilesTable() {
            const percentilesTableBody = document.querySelector('#percentilesTableContent tbody');
            const percentiles = {
                '50th Percentile': (Math.random() * 400).toFixed(2),
                '95th Percentile': (Math.random() * 450).toFixed(2),
                '99th Percentile': (Math.random() * 490).toFixed(2)
            };

            percentilesTableBody.innerHTML = '';
            for (const [percentile, time] of Object.entries(percentiles)) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${percentile}</td>
                    <td>${time}</td>
                `;
                percentilesTableBody.appendChild(row);
            }
        }

        setInterval(updateCharts, 1000);
        setInterval(updateLogs, 2000);
        setInterval(updateCpuUtilization, 1000);
        const interval = setInterval(updateApmMetrics, 1000);

        // setTimeout(() => {
        //     clearInterval(interval)
        // }, 10000)
        setInterval(updateSqlQueryTable, 2000);
        setInterval(updatePercentilesTable, 5000);
        createFlamechart();
    </script>
</body>

</html>