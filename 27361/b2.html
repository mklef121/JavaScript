<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 90%;
            max-width: 800px;
            text-align: center;
            position: relative;
        }

        h1 {
            margin: 0 0 20px 0;
        }

        .text-display {
            margin: 20px 0;
            font-size: 1.2em;
            min-height: 60px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            /* Ensure long words break correctly */
        }

        .text-input {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            /* Ensure padding is included in width */
            min-height: 100px;
            /* Make it a bit taller */
            resize: vertical;
            /* Allow vertical resizing */
        }

        .controls {
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            /* Adjust margin for better spacing */
            transition: background-color 0.3s, transform 0.2s;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        button#start-btn {
            background-color: #4caf50;
            color: white;
        }

        button#reset-btn {
            background-color: #f44336;
            color: white;
        }

        button:hover:not(:disabled) {
            background-color: #555;
            color: #fff;
            transform: scale(1.05);
        }

        .timer,
        .errors,
        .speed {
            font-size: 1em;
            margin: 10px 0;
        }

        .diff-container {
            margin: 20px 0;
            display: none; /* Hidden by default */
        }

        .diff-line {
            min-height: 20px;
            line-height: 20px;
        }

        .diff-original, .diff-user {
            font-size: 1em;
            white-space: pre-wrap;
            word-wrap: break-word;
            padding: 5px;
            border-radius: 5px;
        }

        .diff-original {
            background-color: #ffe6e6; /* Light red for removed */
        }

        .diff-user {
            background-color: #e6ffec; /* Light green for added */
        }

        .diff-added, .diff-removed {
            font-weight: bold;
        }

        .diff-added {
            color: green;
            background-color: #ccffcc;
        }

        .diff-removed {
            color: red;
            background-color: #ffcccc;
            text-decoration: line-through;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Typing Speed Test</h1>
        <div class="game-area">
            <div id="text-display" class="text-display">Press "Start" to begin</div>
            <textarea id="text-input" class="text-input" placeholder="Start typing here..." disabled></textarea>
            <div class="controls">
                <button id="start-btn">Start</button>
                <button id="reset-btn" disabled>Reset</button>
                <button id="diff-btn" disabled>Diff</button>
            </div>
            <div id="timer" class="timer">Time: 0.00s</div>
            <div id="errors" class="errors">Errors: 0</div>
            <div id="speed" class="speed">Speed: 0 WPM</div>
            <div id="diff-container" class="diff-container">
                <div class="diff-original diff-line"></div>
                <div class="diff-user diff-line"></div>
            </div>
        </div>
    </div>

    <script>
        const texts = [
            "The sun was shining brightly in the clear blue sky.",
            "She ate a sandwich for lunch and drank a glass of juice.",
            "The cat purrs contentedly on my lap.",
            "The city is bustling with activity and energy.",
            "He played soccer with his friends until it got dark.",
            "The smell of freshly baked bread filled the air.",
            "The sound of the waves crashing against the shore was soothing.",
            "She loved reading books and learning new things.",
            "The mountain peak was hidden in the mist.",
            "He strummed a gentle melody on his guitar."
        ];

        const startButton = document.getElementById('start-btn');
        const resetButton = document.getElementById('reset-btn');
        const textDisplay = document.getElementById('text-display');
        const textInput = document.getElementById('text-input');
        const timerDisplay = document.getElementById('timer');
        const errorsDisplay = document.getElementById('errors');
        const speedDisplay = document.getElementById('speed');
        const originalTextElement = document.getElementById('original-text');
        const userTextElement = document.getElementById('user-text');

        let startTime, timerInterval, errors, originalText;

        function getRandomText() {
            return texts[Math.floor(Math.random() * texts.length)];
        }

        function startGame() {
            textInput.value = '';
            errors = 0;
            originalText = getRandomText();
            textDisplay.textContent = originalText;
            textInput.disabled = false;
            textInput.focus();
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 100);
            startButton.disabled = true;
            resetButton.disabled = false;
        }

        function resetGame() {
            clearInterval(timerInterval);
            timerDisplay.textContent = 'Time: 0.00s';
            errorsDisplay.textContent = 'Errors: 0';
            speedDisplay.textContent = 'Speed: 0 WPM';
            textDisplay.textContent = 'Press "Start" to begin';
            textInput.disabled = true;
            textInput.value = ''; // Clear the input field
            startButton.disabled = false;
            resetButton.disabled = true;
        }

        function updateTimer() {
            const elapsed = (new Date() - startTime) / 1000;
            timerDisplay.textContent = `Time: ${elapsed.toFixed(2)}s`;
        }

        function calculateWPM(text, time) {
            const words = text.trim().split(/\s+/).length;
            return ((words / time) * 60).toFixed(2);
        }

        textInput.addEventListener('input', function () {
            const userText = textInput.value;
            const originalText = textDisplay.textContent;

            let i = 0;
            while (i < userText.length && i < originalText.length && userText[i] === originalText[i]) {
                i++;
            }

            if (i === originalText.length && userText.length === originalText.length) {
                clearInterval(timerInterval);
                const elapsedTime = (new Date() - startTime) / 1000;
                const wpm = calculateWPM(originalText, elapsedTime / 60);
                speedDisplay.textContent = `Speed: ${wpm} WPM`;
                textInput.disabled = true;
                resetButton.disabled = false;
            } else {
                errors = originalText.slice(0, userText.length).split('').filter((char, idx) => char !== userText[idx]).length;
                errorsDisplay.textContent = `Errors: ${errors}`;
            }
        });

        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', resetGame);

        const diffButton = document.getElementById('diff-btn');
        const diffContainer = document.getElementById('diff-container');
        const diffOriginalDisplay = document.querySelector('.diff-original');
        const diffUserDisplay = document.querySelector('.diff-user');

        function displayDiff() {
            const originalText = textDisplay.textContent;
            const userText = textInput.value;

            const diff = JsDiff.diffWords(originalText, userText);

            let originalDiffHtml = '';
            let userDiffHtml = '';

            diff.forEach(part => {
                const className = part.added ? 'diff-added' : part.removed ? 'diff-removed' : '';
                if (part.removed) {
                    originalDiffHtml += `<span class="${className}">${part.value}</span>`;
                } else if (part.added) {
                    userDiffHtml += `<span class="${className}">${part.value}</span>`;
                } else {
                    originalDiffHtml += part.value;
                    userDiffHtml += part.value;
                }
            });

            diffOriginalDisplay.innerHTML = originalDiffHtml;
            diffUserDisplay.innerHTML = userDiffHtml;
            diffContainer.style.display = 'block';
        }

        diffButton.addEventListener('click', function() {
            if (this.disabled) return;
            displayDiff();
        });

        // Add event listeners to existing buttons to manage the 'Diff' button's state
        startButton.addEventListener('click', function() {
            diffButton.disabled = false;
        });

        resetButton.addEventListener('click', function() {
            diffButton.disabled = true;
            diffContainer.style.display = 'none';
        });

    </script>
</body>

</html>

